Parameters:
  EnvironmentName:
    Description: An environment name that will be prefixed to resource names
    Type: String
    Default: UdacityProject

Resources:
  Ec2Instance:
    Type: "AWS::EC2::Instance"
    Properties:
      SecurityGroupIds:
        - !Ref InstanceSecurityGroup
      KeyName: udacity
      ImageId: ami-0078a04747667d409 # ap-northeast-2
      InstanceType: t2.micro
      SubnetId:
        Fn::ImportValue: !Sub ${EnvironmentName}-PUB1-SN
      BlockDeviceMappings:
        - DeviceName: "/dev/sdm"
          Ebs:
            VolumeType: "io1"
            Iops: "200"
            DeleteOnTermination: "false"
            VolumeSize: "20"
        - DeviceName: "/dev/sdk"
          NoDevice: {}
  InstanceSecurityGroup:
    Type: "AWS::EC2::SecurityGroup"
    Properties:
      GroupDescription: Enable SSH access via port 22
      SecurityGroupIngress:
        - IpProtocol: tcp
          FromPort: "22"
          ToPort: "22"
          CidrIp: 0.0.0.0/0
      VpcId:
        Fn::ImportValue:
          Fn::Sub: "${EnvironmentName}-VPCID"
